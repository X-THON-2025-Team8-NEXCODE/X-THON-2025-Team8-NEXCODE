<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Buy-bye 가계부 캘린더</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

  <style>
    /* === 기본 설정 === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Noto Sans KR", sans-serif;

      background-image: url("./image/background.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .app-frame {
      width: 100vw;
      max-width: 480px; 
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    .top-bar {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-top: 10px;
      cursor: pointer;
    }
    .home-icon {
      width: 40px;
      height: 40px;
      background-image: url('./image/home.png');
      background-size: cover;
    }
    .home-text {
      font-size: 12px;
      color: #555;
      margin-top: 4px;
      font-weight: 600;
      margin-left: 2px;
    }

    .character-area {
      display: flex;
      justify-content: center;
      margin-top: -40px; 
      margin-bottom: 10px;
    }
    .character-img {
      width: 140px; 
      height: 140px;
      object-fit: cover;
      filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
    }

    /* 숨김 (문구 중복 방지용) */
    .info-text { display: none; }

    /* === 말풍선 (씨앗 아래) === */
    .speech {
      display: flex;
      justify-content: center;
      padding: 0 10px;
      margin-bottom: 16px;
    }

    .speech-bubble {
      position: relative;
      max-width: 100%;
      background: #ffffff;
      border-radius: 18px;
      padding: 10px 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
    }

    .speech-bubble::before {
      content: "";
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 0 10px 10px 10px;
      border-style: solid;
      border-color: transparent transparent #ffffff transparent;
      filter: drop-shadow(0 -2px 4px rgba(0, 0, 0, 0.05));
    }

    .typing-text {
      font-size: 0.95rem;
      font-weight: 600;
      color: #333;
      line-height: 1.5;
      min-height: 1.2em;
      white-space: pre-line;
    }

    /* === 캘린더 카드 === */
    .calendar-card {
      background: #ffffff;
      border-radius: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
      padding: 30px 20px;
      flex: none;
      height: auto;
      display: flex;
      flex-direction: column;
    }

    .date-cell.today {
      background-color: #d7fed9 !important; 
      color: #3b691f;
      font-weight: 900;
      border-radius: 12px;
    }

    /* 캘린더 헤더 */
    .cal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 30px;
      padding: 0 10px;
      position: relative;
      z-index: 100;
    }

    .side-month {
      font-size: 1.3rem;
      font-weight: 700;
      color: #aaa;
      cursor: pointer;
      transition: color 0.2s;
    }
    .side-month:hover {
      color: #555;
    }

    .center-date {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 4px;
    }

    .year-select-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .year-display {
      font-size: 1rem;
      font-weight: 700;
      color: #555;
      cursor: pointer;
    }

    .year-select {
      display: none;
    }

    .month-text {
      font-size: 2.2rem;
      font-weight: 900;
      color: #000;
      line-height: 1;
      cursor: pointer;
    }

    /* 요일 라벨 */
    .days-row {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      margin-bottom: 15px;
    }
    .day-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: #888;
    }
    .day-name.sun { color: #e55039; }
    .day-name.sat { color: #3c6382; }

    /* 날짜 그리드 */
    .dates-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px 0;
      text-align: center;
    }
    .date-cell {
      height: 45px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      cursor: pointer;
      border-radius: 12px;
      transition: background 0.2s;
    }
    .date-cell.today {
      background-color: #dff9fb;
      color: #22a6b3;
      font-weight: 800;
    }
    .date-cell:hover {
      background-color: #f0f0f0;
    }
    .date-cell.empty {
      cursor: default;
      pointer-events: none;
    }
    .date-cell.sun { color: #e55039; }
    .date-cell.sat { color: #3c6382; }

    /* ---------- 휠 모달 ---------- */
    .hidden { display: none !important; }

    .wheel-modal {
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      background: rgba(0, 0, 0, 0.25);
      z-index: 999;
    }

    .wheel-panel {
      width: 100%;
      max-width: 480px;
      background: #fdfdfd;
      border-radius: 24px 24px 0 0;
      padding: 10px 20px 20px;
      box-shadow: 0 -10px 24px rgba(0, 0, 0, 0.18);
      animation: slideUp 0.2s ease-out;
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to   { transform: translateY(0);    opacity: 1; }
    }

    .wheel-handle {
      width: 40px;
      height: 4px;
      border-radius: 999px;
      background: #d2d6e0;
      margin: 4px auto 10px;
    }

    .wheel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .wheel-title {
      font-size: 0.95rem;
      font-weight: 700;
      color: #555;
    }

    .wheel-close-btn {
      border: none;
      background: none;
      font-size: 0.95rem;
      font-weight: 700;
      color: #4b7bec;
      cursor: pointer;
    }

    .wheel-body {
      position: relative;
      max-height: 200px;
      overflow-y: auto;
      padding: 8px 0 4px;
      -webkit-overflow-scrolling: touch;
    }

    .wheel-list {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .wheel-item {
      width: 100%;
      max-width: 260px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.05rem;
      color: #a0a3b1;
      cursor: pointer;
      border-radius: 999px;
      transition: all 0.15s ease;
    }

    .wheel-item.selected {
      background: #eef1ff;
      font-size: 1.2rem;
      font-weight: 800;
      color: #222;
      box-shadow: 0 4px 10px rgba(155, 167, 255, 0.35);
    }
  </style>
</head>
<body>

  <div class="app-frame">
    
    <!-- 홈으로 -->
    <div class="top-bar" onclick="location.href='index.html'">
      <div class="home-icon"></div> 
      <div class="home-text">홈 화면</div>
    </div>

    <div class="character-area">
      <img src="./image/seed.png" 
           alt="Character" 
           class="character-img" />
    </div>

    <!-- 말풍선 -->
    <div class="speech">
      <div class="speech-bubble">
        <p id="typing-text" class="typing-text"></p>
      </div>
    </div>

    <!-- (숨김) 원래 텍스트 -->
    <div class="info-text">
      가계부를 자세히 보고 싶은<br>날짜를 클릭하세요!
    </div>

    <div class="calendar-card">
      
      <div class="cal-header">
        <div class="side-month" id="prevMonthBtn" onclick="changeMonth(-1)">10월</div>
        
        <div class="center-date">
          <div class="year-select-wrap">
            <span id="yearDisplay" class="year-display" onclick="openWheel('year')">2025년</span>

            <select id="yearSelect" class="year-select" onchange="changeYear()">
              <!-- 2024 ~ 2050 -->
              <option value="2024">2024년</option>
              <option value="2025">2025년</option>
              <option value="2026">2026년</option>
              <option value="2027">2027년</option>
              <option value="2028">2028년</option>
              <option value="2029">2029년</option>
              <option value="2030">2030년</option>
              <option value="2031">2031년</option>
              <option value="2032">2032년</option>
              <option value="2033">2033년</option>
              <option value="2034">2034년</option>
              <option value="2035">2035년</option>
              <option value="2036">2036년</option>
              <option value="2037">2037년</option>
              <option value="2038">2038년</option>
              <option value="2039">2039년</option>
              <option value="2040">2040년</option>
              <option value="2041">2041년</option>
              <option value="2042">2042년</option>
              <option value="2043">2043년</option>
              <option value="2044">2044년</option>
              <option value="2045">2045년</option>
              <option value="2046">2046년</option>
              <option value="2047">2047년</option>
              <option value="2048">2048년</option>
              <option value="2049">2049년</option>
              <option value="2050">2050년</option>
            </select>
          </div>

          <div class="month-text" id="currentMonth" onclick="openWheel('month')">11월</div>
        </div>
        
        <div class="side-month" id="nextMonthBtn" onclick="changeMonth(1)">12월</div>
      </div>

      <div class="days-row">
        <div class="day-name sun">일</div>
        <div class="day-name">월</div>
        <div class="day-name">화</div>
        <div class="day-name">수</div>
        <div class="day-name">목</div>
        <div class="day-name">금</div>
        <div class="day-name sat">토</div>
      </div>

      <div class="dates-grid" id="datesContainer"></div>

    </div>
  </div>

  <!-- ===== 휠 모달 ===== -->
  <div id="wheelModal" class="wheel-modal hidden">
    <div class="wheel-panel">
      <div class="wheel-handle"></div>
      <div class="wheel-header">
        <span id="wheelTitle" class="wheel-title">연도 선택</span>
        <button type="button" class="wheel-close-btn" onclick="closeWheel()">완료</button>
      </div>
      <div class="wheel-body">
        <div id="wheelList" class="wheel-list"></div>
      </div>
    </div>
  </div>

  <script>
    // === 설정 ===
    let today = new Date();
    let currentYear = today.getFullYear();         // 오늘 연도
    let currentMonth = today.getMonth() + 1;       // 오늘 월 (1~12)

    if (currentYear < 2024) currentYear = 2024;
    if (currentYear > 2050) currentYear = 2050;

    const yearSelect      = document.getElementById('yearSelect');
    const yearDisplay     = document.getElementById('yearDisplay');
    const monthEl         = document.getElementById('currentMonth');
    const prevBtn         = document.getElementById('prevMonthBtn');
    const nextBtn         = document.getElementById('nextMonthBtn');
    const datesContainer  = document.getElementById('datesContainer');

    const wheelModal = document.getElementById('wheelModal');
    const wheelTitle = document.getElementById('wheelTitle');
    const wheelList  = document.getElementById('wheelList');
    let wheelMode    = null; // 'year' | 'month'

    function renderCalendar() {
      if (yearSelect) yearSelect.value = String(currentYear);
      if (yearDisplay) yearDisplay.textContent = `${currentYear}년`;
      monthEl.innerText = `${currentMonth}월`;

      let prevM = currentMonth - 1;
      let nextM = currentMonth + 1;
      if (prevM < 1) prevM = 12;
      if (nextM > 12) nextM = 1;

      prevBtn.innerText = `${prevM}월`;
      nextBtn.innerText = `${nextM}월`;

      datesContainer.innerHTML = '';

      const firstDay  = new Date(currentYear, currentMonth - 1, 1);
      const lastDay   = new Date(currentYear, currentMonth, 0);
      const startDayOfWeek = firstDay.getDay();
      const totalDays      = lastDay.getDate();

      for (let i = 0; i < startDayOfWeek; i++) {
        const emptyDiv = document.createElement('div');
        emptyDiv.classList.add('date-cell', 'empty');
        datesContainer.appendChild(emptyDiv);
      }

      for (let d = 1; d <= totalDays; d++) {
        const dateDiv = document.createElement('div');
        dateDiv.classList.add('date-cell');
        dateDiv.innerText = d;

        const checkDay = new Date(currentYear, currentMonth - 1, d).getDay();
        if (checkDay === 0) dateDiv.classList.add('sun');
        if (checkDay === 6) dateDiv.classList.add('sat');

        if (
          currentYear === today.getFullYear() &&
          currentMonth === (today.getMonth() + 1) &&
          d === today.getDate()
        ) {
          dateDiv.classList.add('today');
        }

        dateDiv.onclick = function() {
          location.href = `calendarBuyList.html?year=${currentYear}&month=${currentMonth}&day=${d}`;
        };

        datesContainer.appendChild(dateDiv);
      }
    }

    function changeMonth(step) {
      currentMonth += step;

      if (currentMonth > 12) {
        currentMonth = 1;
        currentYear++;
      } else if (currentMonth < 1) {
        currentMonth = 12;
        currentYear--;
      }

      if (currentYear < 2024) {
        currentYear = 2024;
        currentMonth = 1;
      }
      if (currentYear > 2050) {
        currentYear = 2050;
        currentMonth = 12;
      }

      renderCalendar();
    }

    function changeYear() {
      currentYear = parseInt(yearSelect.value, 10);
      if (currentYear < 2024) currentYear = 2024;
      if (currentYear > 2050) currentYear = 2050;
      renderCalendar();
    }

    function openWheel(mode) {
      wheelMode = mode;
      wheelList.innerHTML = '';

      if (mode === 'year') {
        wheelTitle.textContent = '연도 선택';
        for (let y = 2024; y <= 2050; y++) {
          const item = document.createElement('div');
          item.className = 'wheel-item';
          if (y === currentYear) item.classList.add('selected');
          item.textContent = `${y}년`;
          item.onclick = () => selectWheelValue(y);
          wheelList.appendChild(item);
        }
      } else if (mode === 'month') {
        wheelTitle.textContent = '월 선택';
        for (let m = 1; m <= 12; m++) {
          const item = document.createElement('div');
          item.className = 'wheel-item';
          if (m === currentMonth) item.classList.add('selected');
          item.textContent = `${m}월`;
          item.onclick = () => selectWheelValue(m);
          wheelList.appendChild(item);
        }
      }

      wheelModal.classList.remove('hidden');
    }

    function closeWheel() {
      wheelModal.classList.add('hidden');
      wheelMode = null;
    }

    function selectWheelValue(value) {
      if (wheelMode === 'year') {
        currentYear = value;
      } else if (wheelMode === 'month') {
        currentMonth = value;
      }
      renderCalendar();
      closeWheel();
    }

    // 말풍선 타이핑
    const typingTarget = document.getElementById("typing-text");
    const typingMessage = "가계부를 자세히 보고 싶은 날짜를 클릭하세요!";
    let typingIndex = 0;

    function typeStep() {
      if (typingIndex <= typingMessage.length) {
        typingTarget.textContent = typingMessage.slice(0, typingIndex);
        typingIndex++;
        setTimeout(typeStep, 60);
      }
    }

    renderCalendar();
    typeStep();
  </script>
  <script src="characterManager.js"></script>
</body>
</html>
